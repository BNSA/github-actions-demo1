name: Hello World Workflow with Tests & Report

on: [push]

jobs:
  greet:
    runs-on: ubuntu-latest
    steps:
      - name: Say Hello
        run: echo "Hello, GitHub Actions!"

  another-job:
    runs-on: ubuntu-latest
    steps:
      - name: Do something else
        run: echo "This is a second job running in parallel!"

  dependent-job:
    runs-on: ubuntu-latest
    needs: greet
    steps:
      - name: Only runs after greet succeeds
        run: echo "Greet job completed â€” now doing follow-up work!"

  secret-demo:
    runs-on: ubuntu-latest
    steps:
      - name: Use the secret safely
        env:
          SECRET_VALUE: ${{ secrets.MY_SECRET_MESSAGE }}
        run: |
          echo "Secret loaded (masked in logs)"
          echo 'Last 4 chars: ${SECRET_VALUE: -4}'
          echo "Full secret (masked): $SECRET_VALUE"

  test-and-report:
    runs-on: ubuntu-latest
    steps:
      - name: Run simple bash tests & generate JUnit report
        run: |
          # Create a simple "test" suite in bash
          echo "Starting fake tests..."

          # Test 1: Should pass
          if [ "hello" = "hello" ]; then
            echo "Test 1 passed"
            status="pass"
          else
            echo "Test 1 failed"
            status="fail"
          fi

          # Test 2: Should fail (for demo)
          if [ "world" = "hello" ]; then
            echo "Test 2 passed"
          else
            echo "Test 2 failed"
            status="fail"
          fi

          # Generate basic JUnit XML report
          cat << 'EOF' > test-report.xml
          <?xml version="1.0" encoding="UTF-8"?>
          <testsuites>
            <testsuite name="Bash Demo Tests" tests="2" failures="1" time="0.1">
              <testcase name="Test equality - should pass" classname="BashTests">
                <passed/>
              </testcase>
              <testcase name="Test equality - should fail" classname="BashTests">
                <failure message="Expected 'hello' but got 'world'">Assertion failed</failure>
              </testcase>
            </testsuite>
          </testsuites>
          EOF

          # Show the report content (for logs)
          cat test-report.xml

      - name: Upload test report artifact
        if: always()  # Run even if tests "fail"
        uses: actions/upload-artifact@v4
        with:
          name: test-report-junit
          path: test-report.xml
          retention-days: 7
