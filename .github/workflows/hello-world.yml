name: Hello World - Beginner Demo (All Features)

on: [push]

jobs:
  greet:
    runs-on: ubuntu-latest
    steps:
      - name: Say Hello
        run: echo "Hello, GitHub Actions world!"

  another-job:
    runs-on: ubuntu-latest
    steps:
      - name: Parallel task
        run: echo "This job runs at the same time as greet!"

  dependent-job:
    runs-on: ubuntu-latest
    needs: greet
    steps:
      - name: Follow-up after greet
        run: echo "Greet job is done — proceeding!"

  secret-demo:
    runs-on: ubuntu-latest
    steps:
      - name: Use secret (must be set in repo Settings > Secrets)
        env:
          SECRET_VALUE: ${{ secrets.MY_SECRET_MESSAGE }}
        run: |
          echo "Secret is loaded but hidden!"
          echo 'Last 4 characters (visible): ${SECRET_VALUE: -4}'
          echo "Full secret (should show ***): $SECRET_VALUE"

  test-matrix-and-artifacts:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        test-group: [group-a, group-b, group-c]
      fail-fast: false
    steps:
      - name: Run fake tests for matrix ${{ matrix.test-group }}
        continue-on-error: true          # ← Added: step fails but job continues & is marked success
        run: |
          echo "Running tests in group: ${{ matrix.test-group }}"

          # Fake test 1: always passes
          echo "Test 1 (pass): OK"

          # Fake test 2: fails only in group-b (for demo)
          if [ "${{ matrix.test-group }}" = "group-b" ]; then
            echo "Test 2 (fail in group-b): FAILED"
            exit 1
          else
            echo "Test 2 (pass): OK"
          fi

      - name: Create simple TXT log file
        if: always()
        run: |
          echo "Matrix group: ${{ matrix.test-group }}" > report-${{ matrix.test-group }}.txt
          echo "Runner: $RUNNER_OS" >> report-${{ matrix.test-group }}.txt
          echo "Job completed at: $(date)" >> report-${{ matrix.test-group }}.txt
          echo "Secret last 4 chars: ${SECRET_VALUE: -4}" >> report-${{ matrix.test-group }}.txt

      - name: Generate JUnit XML test report
        if: always()
        run: |
          cat << EOF > test-report-${{ matrix.test-group }}.xml
          <?xml version="1.0" encoding="UTF-8"?>
          <testsuites>
            <testsuite name="Bash Demo - ${{ matrix.test-group }}" tests="2" failures="0" time="0.1">
              <testcase name="Test 1 - Equality check" classname="BashTests">
                <passed/>
              </testcase>
              <testcase name="Test 2 - Forced fail in group-b" classname="BashTests">
          EOF

          if [ "${{ matrix.test-group }}" = "group-b" ]; then
            echo '                <failure message="Intentional failure for demo">Assertion failed</failure>' >> test-report-${{ matrix.test-group }}.xml
          else
            echo '                <passed/>' >> test-report-${{ matrix.test-group }}.xml
          fi

          echo '              </testcase>' >> test-report-${{ matrix.test-group }}.xml
          echo '            </testsuite>' >> test-report-${{ matrix.test-group }}.xml
          echo '          </testsuites>' >> test-report-${{ matrix.test-group }}.xml

      - name: Upload TXT log artifact (one per matrix)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: log-txt-${{ matrix.test-group }}
          path: report-${{ matrix.test-group }}.txt
          retention-days: 7

      - name: Upload JUnit XML report artifact (one per matrix)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: junit-xml-${{ matrix.test-group }}
          path: test-report-${{ matrix.test-group }}.xml
          retention-days: 7

          
