name: Hello World - Beginner Demo (All Features)

on: [push]  # Triggers on every push to any branch

jobs:
  # 1. Simple greeting job
  greet:
    runs-on: ubuntu-latest
    steps:
      - name: Say Hello
        run: echo "Hello, GitHub Actions world!"

  # 2. Parallel independent job
  another-job:
    runs-on: ubuntu-latest
    steps:
      - name: Parallel task
        run: echo "This job runs at the same time as greet!"

  # 3. Job that depends on greet succeeding
  dependent-job:
    runs-on: ubuntu-latest
    needs: greet  # Waits for 'greet' to finish successfully
    steps:
      - name: Follow-up after greet
        run: echo "Greet job is done â€” proceeding!"

  # 4. Secret handling (masked in logs)
  secret-demo:
    runs-on: ubuntu-latest
    steps:
      - name: Use secret (must be set in repo Settings > Secrets)
        env:
          SECRET_VALUE: ${{ secrets.MY_SECRET_MESSAGE }}
        run: |
          echo "Secret is loaded but hidden!"
          echo 'Last 4 characters (visible): ${SECRET_VALUE: -4}'
          echo "Full secret (should show ***): $SECRET_VALUE"

  # 5. Tests + multiple artifacts + matrix example
  test-matrix-and-artifacts:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        test-group: [group-a, group-b, group-c]  # Simple matrix: 3 variations
        # You could add more: os: [ubuntu-latest, windows-latest]
      fail-fast: false  # Continue even if one matrix fails (good for demo)
    steps:
      - name: Run fake tests for matrix ${{ matrix.test-group }}
        run: |
          echo "Running tests in group: ${{ matrix.test-group }}"

          # Fake test 1: always passes
          echo "Test 1 (pass): OK"

          # Fake test 2: fails only in group-b (for demo failure)
          if [ "${{ matrix.test-group }}" = "group-b" ]; then
            echo "Test 2 (fail in group-b): FAILED"
            exit 1  # Forces step failure in one matrix variation
          else
            echo "Test 2 (pass): OK"
          fi

      - name: Create simple TXT log file
        if: always()  # Run even if tests fail
        run: |
          echo "Matrix group: ${{ matrix.test-group }}" > report-${{ matrix.test-group }}.txt
          echo "Runner: $RUNNER_OS" >> report-${{ matrix.test-group }}.txt
          echo "Job completed at: $(date)" >> report-${{ matrix.test-group }}.txt
          echo "Secret last 4 chars: ${SECRET_VALUE: -4}" >> report-${{ matrix.test-group }}.txt  # Won't show full secret

      - name: Generate JUnit XML test report
        if: always()
        run: |
          # Basic JUnit XML with dynamic matrix info
          cat << EOF > test-report-${{ matrix.test-group }}.xml
          <?xml version="1.0" encoding="UTF-8"?>
          <testsuites>
            <testsuite name="Bash Demo - ${{ matrix.test-group }}" tests="2" failures="0" time="0.1">
              <testcase name="Test 1 - Equality check" classname="BashTests">
                <passed/>
              </testcase>
              <testcase name="Test 2 - Forced fail in group-b" classname="BashTests">
          EOF

          if [ "${{ matrix.test-group }}" = "group-b" ]; then
            echo '                <failure message="Intentional failure for demo">Assertion failed</failure>' >> test-report-${{ matrix.test-group }}.xml
          else
            echo '                <passed/>' >> test-report-${{ matrix.test-group }}.xml
          fi

          echo '              </testcase>' >> test-report-${{ matrix.test-group }}.xml
          echo '            </testsuite>' >> test-report-${{ matrix.test-group }}.xml
          echo '          </testsuites>' >> test-report-${{ matrix.test-group }}.xml

      - name: Upload TXT log artifact (one per matrix)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: log-txt-${{ matrix.test-group }}
          path: report-${{ matrix.test-group }}.txt
          retention-days: 7

      - name: Upload JUnit XML report artifact (one per matrix)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: junit-xml-${{ matrix.test-group }}
          path: test-report-${{ matrix.test-group }}.xml
          retention-days: 7
          
